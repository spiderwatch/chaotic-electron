const dialogButton = document.querySelector('#dialogButton');
const toastButton = document.querySelector('#toastButton');
let dialog = document.querySelector('#logoutModal');
let toastHolder = document.querySelector('#toastHolder');

function show() {
    dialog.showModal();
}

dialogButton.addEventListener('click', () => {
    show();
});

async function toast(header, content, faIcon) {
    console.log('Creating toast');

    let toast = document.createElement('div');
    toast.classList.add('toast');

    let iconBlock = document.createElement('div');
    iconBlock.classList.add('toastIconBlock');
    let icon = document.createElement('i');
    icon.classList.add('fas', faIcon, 'fa-2x');
    iconBlock.appendChild(icon);
    toast.appendChild(iconBlock);

    let textBlock = document.createElement('div');
    textBlock.classList.add('toastContentBlock');
    let title = document.createElement('h4');
    title.classList.add('toastHeader');
    title.textContent = header;
    textBlock.appendChild(title);
    let message = document.createElement('p');
    message.classList.add('toastContent');
    message.textContent = content;
    textBlock.appendChild(message);
    toast.appendChild(textBlock);

    let actionBlock = document.createElement('div');
    actionBlock.classList.add('toastActionBlock');
    let action = document.createElement('button');
    action.classList.add('toastCloseAction');
    let closeActionIcon = document.createElement('i')
    closeActionIcon.classList.add('fas', 'fa-times');
    action.appendChild(closeActionIcon);
    actionBlock.appendChild(action);
    toast.appendChild(actionBlock);

    let toastTimer = document.createElement('progress');
    toastTimer.classList.add('toastTimer');
    toastTimer.value = 0;
    toastTimer.max = 5000;
    toast.appendChild(toastTimer);
    
    let thisToast = toastHolder.appendChild(toast);
    thisToast.classList.add('show');

    let thisTimer = setInterval(() => {
        toastTimer.value += 5;
    }, 1);

    setTimeout(() => {
        clearInterval(thisTimer);
        thisToast.remove();
    }, 5000);

    action.addEventListener('click', () => {
        clearInterval(thisTimer);
        thisToast.remove();
    });

    console.log('Toast created: ' + header + ' - ' + content + ' - ' + faIcon);
}

toastButton.addEventListener('click', () => {
    toast("Demo Toast", "This toast was generated by the \"Create a toast\" button.", "fa-gamepad-modern");
});

let starterToast = `
    <div class="toast show">
        <div class="toastIconBlock">
            <i class="fa-sharp fa-info-circle fa-2x"></i>
        </div>
        <div class="toastContentBlock">
            <h4 class="toastHeader">ToastHeader</h4>
            <p class="toastContent">ToastContent</p>
            <p class="toastContent">Really long toast content block to test the dynamic addition of height to the toast box when the toast content is really long. toast toast toast toast toast</p>
        </div>
    </div>
`;

starterToast = new DOMParser().parseFromString(starterToast, 'text/html').body.firstChild;
let starterToastPlaced = toastHolder.appendChild(starterToast);